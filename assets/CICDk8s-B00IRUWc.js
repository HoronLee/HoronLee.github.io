import{_ as r}from"./ValaxyMain.vue_vue_type_style_index_0_lang-BlZE3LhB.js";import{_ as d,a as c,p as o,o as E,c as g,w as a,f as s,g as i,h as t,s as y,r as n,i as u}from"./app-DYGYtZ5U.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-B9Dth9xg.js";import"./YunCard.vue_vue_type_script_setup_true_lang-ZIvkhB7t.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-nY4cFgbl.js";import"./index-C7yU5XnD.js";const h=JSON.parse('{"title":"在k8s中构建CICD","description":"","frontmatter":{"layout":"post","title":"在k8s中构建CICD","date":"2024-02-27T15:07:00.000Z","tags":["CentOS","Linux","Kubernetes"],"categories":["服务器运维","云计算","Kubernetes","CICD"],"cover":"https://www.kubernetes.org.cn/img/2020/10/jenkins-logo.jpg","password":null,"hide":null},"headers":[{"level":2,"title":"Jenkins部署","slug":"jenkins部署","link":"#jenkins部署","children":[]},{"level":2,"title":"GitLab部署","slug":"gitlab部署","link":"#gitlab部署","children":[]},{"level":2,"title":"Jenkinsfile流水线","slug":"jenkinsfile流水线","link":"#jenkinsfile流水线","children":[]},{"level":2,"title":"配置NFS服务","slug":"配置nfs服务","link":"#配置nfs服务","children":[]},{"level":2,"title":"nfs-storage实现Jenkins持久化存储","slug":"nfs-storage实现jenkins持久化存储","link":"#nfs-storage实现jenkins持久化存储","children":[]}],"relativePath":"pages/posts/CICDk8s.md","path":"/home/runner/work/horonlee.github.io/horonlee.github.io/pages/posts/CICDk8s.md","lastUpdated":1711418005000}'),F={name:"pages/posts/CICDk8s.md",data(){return{data:h,frontmatter:h.frontmatter,$frontmatter:h.frontmatter}},setup(){const l=c();l.meta.frontmatter=Object.assign(l.meta.frontmatter||{},h.frontmatter||{}),o("pageData",h)}},m={id:"安装cicd所需资源",tabindex:"-1"},C=s("p",null,[s("code",null,"curl -O http://mirrors.douxuedu.com/competition/BlueOcean.tar.gz && tar -zxf BlueOcean.tar.gz && cp BlueOcean/tools/docker-compose-Linux-x86_64 /usr/bin/docker-compose && docker-compose version && tar -zxf BlueOcean/harbor-offline-installer.tar.gz -C /opt/ && sh /opt/harbor/install.sh && docker login -uadmin -pHarbor12345 172.16.2.90 && docker load -i BlueOcean/images/maven_latest.tar && docker tag maven 172.16.2.90/library/maven && docker push 172.16.2.90/library/maven && docker load -i BlueOcean/images/java_8-jre.tar && docker load -i BlueOcean/images/jenkins_jenkins_latest.tar && docker load -i BlueOcean/images/gitlab_gitlab-ce_latest.tar && kubectl create ns devops")],-1),b={id:"部署应用",tabindex:"-1"},f={id:"jenkins部署",tabindex:"-1"},B=s("p",null,[i("容器部分 "),s("code",null,"kubectl create deployment jenkins --image=jenkins/jenkins:latest --namespace=devops --port=8080 --dry-run=client -o yaml >> jenkins.yaml"),i(" 服务部分 "),s("code",null,"kubectl create service nodeport jenkins --tcp=8080:8080 --namespace=devops --dry-run=client -o yaml >> jenkins.yaml"),i(" 修改部分内容")],-1),v=s("div",{class:"language-yaml"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"yaml"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      serviceAccountName"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"jenkins")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        imagePullPolicy"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"IfNotPresent")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        securityContext"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": ")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          runAsUser"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          privileged"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"true")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        volumeMounts"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"mountPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/var/jenkins_home")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"jenkinshome")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"mountPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/usr/bin/docker")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"docker")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"mountPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/var/run/docker.sock")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"dockersock")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"mountPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/usr/bin/kubectl")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"kubectl")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"mountPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/root/.kube")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"kubeconfig")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      volumes"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"jenkinshome")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        hostPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          path"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/home/jenkins_home")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"docker")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        hostPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          path"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/usr/bin/docker")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"dockersock")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        hostPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          path"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/var/run/docker.sock")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"kubectl")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        hostPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          path"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/usr/bin/kubectl")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"kubeconfig")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        hostPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          path"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/root/.kube")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"---")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    nodePort"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"30880")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"---")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"kubectl create clusterrole jenkins --verb=* --resource=* --namespace=devops --dry-run=client -o yaml >> jenkins.yaml")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"---")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"kubectl create serviceaccount jenkins --namespace=devops --dry-run=client -o yaml >> jenkins.yaml")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"---")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"kubectl create clusterrolebinding jenkins --clusterrole=jenkins --serviceaccount=devops:jenkins --namespace=devops --dry-run=client -o yaml >> jenkins.yaml")])])]),s("button",{class:"collapse"})],-1),_={id:"gitlab部署",tabindex:"-1"},D=s("p",null,[i("容器部分 "),s("code",null,"kubectl create deployment gitlab --image=gitlab/gitlab-ce:latest --port=80 --namespace=devops --dry-run=client -o yaml >> gitlab.yaml"),i(" 服务部分 "),s("code",null,"kubectl create service nodeport gitlab --tcp=80:80 --namespace=devops --dry-run=client -o yaml >> gitlab.yaml"),i(" 修改部分内容")],-1),A=s("div",{class:"language-"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",null,"        env:")]),i(`
`),s("span",{class:"line"},[s("span",null,"        - name: GITLAB_ROOT_PASSWORD")]),i(`
`),s("span",{class:"line"},[s("span",null,"          value: admin@123")]),i(`
`),s("span",{class:"line"},[s("span",null,"        - name: GITLAB_PORT")]),i(`
`),s("span",{class:"line"},[s("span",null,'          value: "80"')])])]),s("button",{class:"collapse"})],-1),j={id:"jenkinsfile流水线",tabindex:"-1"},P=s("div",{class:"language-"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",null,"pipeline{")]),i(`
`),s("span",{class:"line"},[s("span",null,"    agent none")]),i(`
`),s("span",{class:"line"},[s("span",null,"    stages{")]),i(`
`),s("span",{class:"line"},[s("span",null,"        stage('mvn-build'){")]),i(`
`),s("span",{class:"line"},[s("span",null,"            agent {")]),i(`
`),s("span",{class:"line"},[s("span",null,"                docker {")]),i(`
`),s("span",{class:"line"},[s("span",null,"                    image '10.26.15.244/library/maven'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                    args '-v /root/.m2:/root/.m2'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                }")]),i(`
`),s("span",{class:"line"},[s("span",null,"            }")]),i(`
`),s("span",{class:"line"},[s("span",null,"            steps{")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'cp -rfv /opt/repository /root/.m2/ && ls -l /root/.m2/repository'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'mvn package -DskipTests'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                archiveArtifacts artifacts: '**/target/*.jar', fingerprint: true ")]),i(`
`),s("span",{class:"line"},[s("span",null,"            }")]),i(`
`),s("span",{class:"line"},[s("span",null,"        }")]),i(`
`),s("span",{class:"line"},[s("span",null,"        stage('image-build'){")]),i(`
`),s("span",{class:"line"},[s("span",null,"            agent any")]),i(`
`),s("span",{class:"line"},[s("span",null,"            steps{")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'cd gateway && docker build -t 10.26.15.244/springcloud/gateway -f Dockerfile .'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'cd config && docker build -t 10.26.15.244/springcloud/config -f Dockerfile .'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'docker login 10.26.15.244 -u=admin -p=Harbor12345'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'docker push 10.26.15.244/springcloud/gateway'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'docker push 10.26.15.244/springcloud/config'")]),i(`
`),s("span",{class:"line"},[s("span",null,"            }")]),i(`
`),s("span",{class:"line"},[s("span",null,"        }")]),i(`
`),s("span",{class:"line"},[s("span",null,"        stage('cloud-deploy'){")]),i(`
`),s("span",{class:"line"},[s("span",null,"            agent any")]),i(`
`),s("span",{class:"line"},[s("span",null,"            steps{")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'kubectl create ns springcloud'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'kubectl apply -f yaml/deployment/gateway-deployment.yaml'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'kubectl apply -f yaml/deployment/config-deployment.yaml'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'kubectl apply -f yaml/svc/gateway-svc.yaml'")]),i(`
`),s("span",{class:"line"},[s("span",null,"                sh 'kubectl apply -f yaml/svc/config-svc.yaml'")]),i(`
`),s("span",{class:"line"},[s("span",null,"            }")]),i(`
`),s("span",{class:"line"},[s("span",null,"        }")]),i(`
`),s("span",{class:"line"},[s("span",null,"    }")]),i(`
`),s("span",{class:"line"},[s("span",null,"}")])])]),s("button",{class:"collapse"})],-1),$={id:"使用nfs和pvc持久化存储jenkins数据",tabindex:"-1"},O={id:"配置nfs服务",tabindex:"-1"},w=s("p",null,"Worker节点",-1),N=s("div",{class:"language-bash"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mkdir"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /opt/jenkins_home")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"vi"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /etc/exports")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"写入：/opr/jenkins_home"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," *"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"rw,sync,no_root_squash"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"systemctl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," enable"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," nfs-server"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --now")])])]),s("button",{class:"collapse"})],-1),I=s("p",null,"Master节点",-1),J=s("div",{class:"language-bash"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mkdir"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /opt/jenkins_home")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"mount"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," nfs-server-ip:/opt/jenkins_home"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /opt/jenkins_home")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"df"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -Th"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," grep"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," jenkins")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"输出：$nfs-server-ip-address:/opt/jenkins_home"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," nfs4"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 40"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"G"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 19"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"G"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 22"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"G"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 46"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"%"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /opt/jenkins_home")])])]),s("button",{class:"collapse"})],-1),V={id:"nfs-storage实现jenkins持久化存储",tabindex:"-1"},x=s("p",null,"在deployment下方加上卷挂载信息",-1),G=s("div",{class:"language-yaml"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"yaml"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        volumeMounts"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"jenkins")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          mountPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/var/jenkins_home")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      volumes"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      - "),s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"jenkins")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"        persistentVolumeClaim"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"          claimName"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"jenkins-pvc")])])]),s("button",{class:"collapse"})],-1),S=s("p",null,"创建pv.yaml",-1),L=s("div",{class:"language-yaml"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"yaml"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"apiVersion"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"v1")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"kind"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"PersistentVolume")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"metadata"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"jenkins-pv")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"spec"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  capacity"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    storage"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"5Gi")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  accessModes"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"ReadWriteOnce")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  nfs"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    server"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"$nfs-server-ip-address")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    path"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"/opt/jenkins_home")])])]),s("button",{class:"collapse"})],-1),T=s("p",null,"创建pvc.yaml",-1),M=s("div",{class:"language-yaml"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"yaml"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"apiVersion"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"v1")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"kind"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"PersistentVolumeClaim")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"metadata"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  name"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"jenkins-pvc")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"spec"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  accessModes"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    - "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"ReadWriteOnce")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"  resources"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"    requests"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"}},"      storage"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"5Gi")])])]),s("button",{class:"collapse"})],-1);function R(l,z,W,q,k,H){const e=u,p=r;return E(),g(p,{frontmatter:k.frontmatter,data:k.data},{"main-content-md":a(()=>[s("h1",m,[i("安装CICD所需资源 "),t(e,{class:"header-anchor",href:"#安装cicd所需资源","aria-label":'Permalink to "安装CICD所需资源"'},{default:a(()=>[i("​")]),_:1})]),C,y(" more "),s("h1",b,[i("部署应用 "),t(e,{class:"header-anchor",href:"#部署应用","aria-label":'Permalink to "部署应用"'},{default:a(()=>[i("​")]),_:1})]),s("h2",f,[i("Jenkins部署 "),t(e,{class:"header-anchor",href:"#jenkins部署","aria-label":'Permalink to "Jenkins部署"'},{default:a(()=>[i("​")]),_:1})]),B,v,s("h2",_,[i("GitLab部署 "),t(e,{class:"header-anchor",href:"#gitlab部署","aria-label":'Permalink to "GitLab部署"'},{default:a(()=>[i("​")]),_:1})]),D,A,s("h2",j,[i("Jenkinsfile流水线 "),t(e,{class:"header-anchor",href:"#jenkinsfile流水线","aria-label":'Permalink to "Jenkinsfile流水线"'},{default:a(()=>[i("​")]),_:1})]),P,s("h1",$,[i("使用NFS和PVC持久化存储Jenkins数据 "),t(e,{class:"header-anchor",href:"#使用nfs和pvc持久化存储jenkins数据","aria-label":'Permalink to "使用NFS和PVC持久化存储Jenkins数据"'},{default:a(()=>[i("​")]),_:1})]),s("h2",O,[i("配置NFS服务 "),t(e,{class:"header-anchor",href:"#配置nfs服务","aria-label":'Permalink to "配置NFS服务"'},{default:a(()=>[i("​")]),_:1})]),w,N,I,J,s("h2",V,[i("nfs-storage实现Jenkins持久化存储 "),t(e,{class:"header-anchor",href:"#nfs-storage实现jenkins持久化存储","aria-label":'Permalink to "nfs-storage实现Jenkins持久化存储"'},{default:a(()=>[i("​")]),_:1})]),x,G,S,L,T,M]),"main-header":a(()=>[n(l.$slots,"main-header")]),"main-header-after":a(()=>[n(l.$slots,"main-header-after")]),"main-nav":a(()=>[n(l.$slots,"main-nav")]),"main-content":a(()=>[n(l.$slots,"main-content")]),"main-content-after":a(()=>[n(l.$slots,"main-content-after")]),"main-nav-before":a(()=>[n(l.$slots,"main-nav-before")]),"main-nav-after":a(()=>[n(l.$slots,"main-nav-after")]),comment:a(()=>[n(l.$slots,"comment")]),footer:a(()=>[n(l.$slots,"footer")]),aside:a(()=>[n(l.$slots,"aside")]),"aside-custom":a(()=>[n(l.$slots,"aside-custom")]),default:a(()=>[n(l.$slots,"default")]),_:3},8,["frontmatter","data"])}const ss=d(F,[["render",R]]);export{h as data,ss as default};
